<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ì—­ì‚¬ì˜ ê· ì—´ - ì§€í•˜ 25ì¸µ íƒˆì¶œ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: #0a0a0f;
            color: #ffffff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(120, 0, 255, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(0, 255, 200, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(255, 0, 128, 0.05) 0%, transparent 70%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: linear-gradient(145deg, rgba(20, 20, 35, 0.95), rgba(10, 10, 20, 0.98));
            border: 2px solid transparent;
            border-image: linear-gradient(135deg, #00ffc8, #7b2fff, #ff0080) 1;
            border-radius: 20px;
            box-shadow: 
                0 0 60px rgba(123, 47, 255, 0.3),
                0 0 100px rgba(0, 255, 200, 0.1),
                inset 0 0 60px rgba(0, 0, 0, 0.5);
            padding: 35px;
            position: relative;
            z-index: 1;
        }

        .container::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(135deg, #00ffc8, #7b2fff, #ff0080, #00ffc8);
            border-radius: 22px;
            z-index: -1;
            animation: borderGlow 3s linear infinite;
            background-size: 300% 300%;
        }

        .container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(145deg, rgba(20, 20, 35, 0.98), rgba(10, 10, 20, 0.99));
            border-radius: 18px;
            z-index: -1;
        }

        @keyframes borderGlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .header {
            text-align: center;
            margin-bottom: 25px;
        }

        .floor-display {
            font-family: 'Orbitron', sans-serif;
            font-size: 3em;
            font-weight: 900;
            background: linear-gradient(135deg, #00ffc8, #7b2fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(0, 255, 200, 0.5);
            margin-bottom: 8px;
            letter-spacing: 4px;
            filter: drop-shadow(0 0 20px rgba(123, 47, 255, 0.5));
        }

        .era-display {
            font-size: 1.1em;
            color: #a0a0b0;
            margin-bottom: 15px;
            letter-spacing: 2px;
        }

        .timer-display {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5em;
            color: #00ffc8;
            text-shadow: 0 0 15px rgba(0, 255, 200, 0.7);
            margin-bottom: 15px;
        }

        .stats-row {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(123, 47, 255, 0.1);
            border: 1px solid rgba(123, 47, 255, 0.3);
            border-radius: 20px;
        }

        .stat-label {
            color: #a0a0b0;
            font-size: 0.9em;
        }

        .stat-value {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            color: #ff0080;
        }

        .progress-container {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
            position: relative;
            border: 1px solid rgba(123, 47, 255, 0.3);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #7b2fff 0%, #00ffc8 50%, #ff0080 100%);
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 20px rgba(0, 255, 200, 0.6);
            position: relative;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .story-box {
            background: rgba(123, 47, 255, 0.05);
            border: 1px solid rgba(123, 47, 255, 0.2);
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            line-height: 1.9;
            font-size: 1.05em;
            color: #d0d0e0;
        }

        .question {
            font-size: 1.25em;
            font-weight: 700;
            background: linear-gradient(135deg, #ffffff, #00ffc8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 25px;
            text-align: center;
            line-height: 1.6;
        }

        .choices {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }

        .choice-btn {
            background: linear-gradient(135deg, rgba(123, 47, 255, 0.1), rgba(0, 255, 200, 0.05));
            border: 1px solid rgba(123, 47, 255, 0.3);
            color: #ffffff;
            padding: 18px 25px;
            font-size: 1.05em;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.15s ease-out;
            text-align: left;
            font-family: inherit;
            position: relative;
            overflow: hidden;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }

        /* í˜¸ë²„ íš¨ê³¼ëŠ” ë§ˆìš°ìŠ¤ì—ì„œë§Œ */
        @media (hover: hover) {
            .choice-btn:hover {
                background: linear-gradient(135deg, rgba(123, 47, 255, 0.2), rgba(0, 255, 200, 0.15));
                border-color: #00ffc8;
                transform: translateX(8px);
                box-shadow: 0 0 30px rgba(0, 255, 200, 0.3);
            }
        }

        .choice-btn:active {
            transform: scale(0.98);
            background: linear-gradient(135deg, rgba(123, 47, 255, 0.3), rgba(0, 255, 200, 0.2));
        }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background: linear-gradient(145deg, rgba(20, 20, 35, 0.98), rgba(10, 10, 20, 0.99));
            border: 2px solid;
            border-image: linear-gradient(135deg, #00ffc8, #7b2fff, #ff0080) 1;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 0 80px rgba(123, 47, 255, 0.4);
            animation: slideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .modal-content h2 {
            font-size: 1.8em;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #00ffc8, #7b2fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .modal-content p {
            font-size: 1.1em;
            line-height: 1.7;
            margin: 15px 0;
            color: #d0d0e0;
        }

        .modal-btn {
            background: linear-gradient(135deg, #7b2fff, #00ffc8);
            border: none;
            color: #0a0a0f;
            padding: 15px 40px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            border-radius: 25px;
            margin-top: 25px;
            transition: all 0.3s;
            box-shadow: 0 5px 25px rgba(123, 47, 255, 0.4);
            font-family: inherit;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }

        .modal-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 35px rgba(0, 255, 200, 0.5);
        }

        /* ì¸íŠ¸ë¡œ í™”ë©´ */
        #introScreen {
            text-align: center;
        }

        .intro-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5em;
            font-weight: 900;
            background: linear-gradient(135deg, #ff0080, #7b2fff, #00ffc8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 30px;
            animation: titlePulse 2s ease-in-out infinite;
        }

        @keyframes titlePulse {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(123, 47, 255, 0.5)); }
            50% { filter: drop-shadow(0 0 40px rgba(0, 255, 200, 0.8)); }
        }

        .intro-story {
            font-size: 1.1em;
            line-height: 2;
            color: #b0b0c0;
            margin-bottom: 30px;
            text-align: left;
            padding: 25px;
            background: rgba(123, 47, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(123, 47, 255, 0.2);
        }

        .name-input-section {
            margin: 30px 0;
        }

        .name-input-section label {
            display: block;
            margin-bottom: 12px;
            color: #00ffc8;
            font-size: 1.1em;
        }

        .name-input {
            width: 100%;
            max-width: 300px;
            padding: 15px 20px;
            font-size: 1.1em;
            border: 2px solid rgba(123, 47, 255, 0.5);
            border-radius: 12px;
            background: rgba(10, 10, 20, 0.8);
            color: #ffffff;
            text-align: center;
            font-family: inherit;
            transition: all 0.3s;
        }

        .name-input:focus {
            outline: none;
            border-color: #00ffc8;
            box-shadow: 0 0 20px rgba(0, 255, 200, 0.3);
        }

        .name-input::placeholder {
            color: #606070;
        }

        .start-btn {
            background: linear-gradient(135deg, #ff0080, #7b2fff);
            border: none;
            color: #ffffff;
            padding: 18px 60px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            border-radius: 30px;
            margin-top: 25px;
            transition: all 0.3s;
            box-shadow: 0 5px 30px rgba(255, 0, 128, 0.4);
            font-family: inherit;
            letter-spacing: 2px;
        }

        .start-btn:hover {
            transform: scale(1.05) translateY(-2px);
            box-shadow: 0 10px 40px rgba(255, 0, 128, 0.6);
        }

        .start-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* ë¦¬ë”ë³´ë“œ ë²„íŠ¼ */
        .leaderboard-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 0, 128, 0.2);
            border: 1px solid rgba(255, 0, 128, 0.5);
            color: #ff0080;
            padding: 10px 20px;
            font-size: 0.95em;
            cursor: pointer;
            border-radius: 20px;
            transition: all 0.3s;
            font-family: inherit;
            z-index: 10;
        }

        .leaderboard-btn:hover {
            background: rgba(255, 0, 128, 0.3);
            box-shadow: 0 0 20px rgba(255, 0, 128, 0.4);
        }

        /* ë¦¬ë”ë³´ë“œ í…Œì´ë¸” */
        .leaderboard-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5em;
            text-align: center;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #ff0080, #7b2fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
        }

        .leaderboard-table th {
            padding: 12px;
            text-align: left;
            color: #00ffc8;
            font-weight: 700;
            border-bottom: 2px solid rgba(0, 255, 200, 0.3);
            font-size: 0.9em;
        }

        .leaderboard-table td {
            padding: 12px;
            border-bottom: 1px solid rgba(123, 47, 255, 0.2);
            color: #d0d0e0;
        }

        .leaderboard-table tr:hover td {
            background: rgba(123, 47, 255, 0.1);
        }

        .rank-badge {
            display: inline-block;
            width: 28px;
            height: 28px;
            line-height: 28px;
            text-align: center;
            border-radius: 50%;
            font-weight: bold;
            font-size: 0.9em;
        }

        .rank-badge.gold {
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            color: #1a1a1a;
        }

        .rank-badge.silver {
            background: linear-gradient(135deg, #e0e0e0, #a0a0a0);
            color: #1a1a1a;
        }

        .rank-badge.bronze {
            background: linear-gradient(135deg, #cd7f32, #8b4513);
            color: #ffffff;
        }

        .no-records {
            text-align: center;
            color: #606070;
            padding: 30px;
            font-size: 1.1em;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(0, 255, 200, 0.3);
            border-top-color: #00ffc8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ì„¤ì • ì•ˆë‚´ ë°•ìŠ¤ */
        .setup-notice {
            background: rgba(255, 0, 128, 0.1);
            border: 1px solid rgba(255, 0, 128, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 0.9em;
            color: #ff9999;
        }

        .setup-notice code {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }

        /* ì• ë‹ˆë©”ì´ì…˜ */
        .shock-effect {
            animation: electricShock 0.5s;
        }

        @keyframes electricShock {
            0%, 100% { filter: brightness(1); }
            25% { filter: brightness(2) hue-rotate(90deg); }
            50% { filter: brightness(0.5); }
            75% { filter: brightness(2) hue-rotate(-90deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { 
                transform: translateY(-30px) scale(0.95);
                opacity: 0;
            }
            to { 
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .success-glow {
            animation: successPulse 1s;
        }

        @keyframes successPulse {
            0%, 100% { box-shadow: 0 0 60px rgba(123, 47, 255, 0.3); }
            50% { box-shadow: 0 0 100px rgba(0, 255, 200, 0.8); }
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }

            .floor-display {
                font-size: 2.2em;
            }

            .intro-title {
                font-size: 1.8em;
            }

            .stats-row {
                flex-direction: column;
                gap: 10px;
            }

            .leaderboard-btn {
                position: static;
                margin-bottom: 20px;
            }

            .leaderboard-table th,
            .leaderboard-table td {
                padding: 8px 5px;
                font-size: 0.85em;
            }
        }

        #gameScreen {
            display: none;
        }

        #leaderboardScreen {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container" id="gameContainer">
        <!-- ë¦¬ë”ë³´ë“œ ë²„íŠ¼ -->
        <button class="leaderboard-btn" onclick="showLeaderboard()">ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹</button>

        <!-- ì¸íŠ¸ë¡œ í™”ë©´ -->
        <div id="introScreen">
            <h1 class="intro-title">ğŸŒ€ ì—­ì‚¬ì˜ ê· ì—´</h1>
            <div class="intro-story">
                <p>ì—­ì‚¬ì˜ íë¦„ì— ê· ì—´ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
                <p>ë‹¹ì‹ ì€ ì‹œê°„ ì—¬í–‰ìë¡œì„œ <strong style="color: #ff0080;">ì§€í•˜ 25ì¸µ</strong> ê¹Šì€ ê³³ì— ê°‡í˜”ìŠµë‹ˆë‹¤.</p>
                <p>ê° ì¸µì—ëŠ” ì—­ì‚¬ì˜ ì‹œí—˜ì´ ê¸°ë‹¤ë¦¬ê³  ìˆìœ¼ë©°,<br>
                ë¬¸ì œë¥¼ ë§í˜€ ì§€ìƒìœ¼ë¡œ ì˜¬ë¼ê°€ì•¼ ê· ì—´ì„ ë‹«ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                <p style="color: #ff0080; font-weight: bold;">âš ï¸ ê²½ê³ : 5ë²ˆ ì˜¤ë‹µ ì‹œ ê· ì—´ì´ ì™„ì „íˆ ì»¤ì ¸ ì—­ì‚¬ê°€ ë¶•ê´´ë©ë‹ˆë‹¤.</p>
                <p style="color: #00ffc8;">ğŸ’¡ ì§€í•˜ 10ì¸µë¶€í„°ëŠ” ì•ˆì „ì§€ëŒ€ê°€ í™œì„±í™”ë©ë‹ˆë‹¤.</p>
            </div>

            <div class="name-input-section">
                <label for="playerName">íƒˆì¶œì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”</label>
                <input type="text" id="playerName" class="name-input" placeholder="ì´ë¦„ (2~10ì)" maxlength="10">
            </div>

            <button class="start-btn" onclick="startGame()" id="startBtn">íƒˆì¶œ ì‹œì‘í•˜ê¸°</button>
        </div>

        <!-- ê²Œì„ í™”ë©´ -->
        <div id="gameScreen">
            <div class="header">
                <div class="floor-display" id="floorDisplay">B25F</div>
                <div class="era-display" id="eraDisplay">ê³ ë ¤ ê±´êµ­</div>
                <div class="timer-display">â±ï¸ <span id="timerDisplay">00:00</span></div>
                <div class="stats-row">
                    <div class="stat-item">
                        <span class="stat-label">ê· ì—´ ìƒíƒœ</span>
                        <span class="stat-value"><span id="mistakeCount">0</span>/5</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ì•ˆì „ì§€ëŒ€</span>
                        <span class="stat-value" id="safeZoneStatus">âŒ</span>
                    </div>
                </div>
                <div class="progress-container">
                    <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                </div>
            </div>

            <div class="story-box">
                <p class="question" id="question">ë¬¸ì œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                <div class="choices" id="choices"></div>
            </div>
        </div>

        <!-- ë¦¬ë”ë³´ë“œ í™”ë©´ -->
        <div id="leaderboardScreen">
            <h2 class="leaderboard-title">ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹</h2>
            <p style="text-align: center; color: #a0a0b0; margin-bottom: 20px;">ì—­ì‚¬ì˜ ê· ì—´ì„ ë‹«ê³  íƒˆì¶œì— ì„±ê³µí•œ ì˜ì›…ë“¤</p>
            
            <div id="leaderboardContent">
                <div class="no-records">
                    <span class="loading-spinner"></span> ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                </div>
            </div>

            <div style="text-align: center; margin-top: 25px;">
                <button class="modal-btn" onclick="hideLeaderboard()">ëŒì•„ê°€ê¸°</button>
            </div>
        </div>
    </div>

    <!-- ëª¨ë‹¬ -->
    <div class="modal" id="modal">
        <div class="modal-content" id="modalContent"></div>
    </div>

    <script>
        // ========================================================
        // âš ï¸ ì¤‘ìš”: ì•„ë˜ URLì„ Google Apps Script ì›¹ ì•± URLë¡œ êµì²´í•˜ì„¸ìš”!
        // ========================================================
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby98zwMfX6uZ6ke4i0QQLsTfDQfSPehx20CFtiYGCMHAufXZGQxbQGGGSps58Km_hn6Ng/exec';
        // ì˜ˆì‹œ: 'https://script.google.com/macros/s/AKfycbw.../exec'
        // ========================================================

        // ========== ì›ë³¸ ë¬¸ì œ ë°ì´í„° (ê·¸ëŒ€ë¡œ ìœ ì§€) ==========
        const originalQuestions = [
            {
                floor: 25,
                era: "ê³ ë ¤ ê±´êµ­",
                question: "ê³ ë ¤ë¥¼ ê±´êµ­í•œ ì¸ë¬¼ì€ ëˆ„êµ¬ì¸ê°€?",
                choices: ["ê²¬í›¤", "ê²½ìˆœì™•", "ì™•ê±´", "ê¶ì˜ˆ", "ìµœì¶©í—Œ"],
                answer: 2
            },
            {
                floor: 24,
                era: "í›„ì‚¼êµ­ í†µì¼",
                question: "ê³ ë ¤ê°€ í›„ì‚¼êµ­ì„ í†µì¼í•œ í•´ëŠ”?",
                choices: ["936ë…„", "935ë…„", "918ë…„", "926ë…„", "956ë…„"],
                answer: 0
            },
            {
                floor: 23,
                era: "ê³ ë ¤ í†µì¹˜ ì²´ì œ",
                question: "ê´€ë¦¬ ì„ ë°œì„ ìœ„í•´ ê³ ë ¤ì—ì„œ ì‹¤ì‹œí•œ ì‹œí—˜ì œë„ëŠ”?",
                choices: ["ì²œê±°", "ìŒì„œ", "êµ°ì—­ì œ", "ê³µë‚©ì œ", "ê³¼ê±°ì œ"],
                answer: 4
            },
            {
                floor: 22,
                era: "ê³ ë ¤ íƒœì¡°ì˜ ì •ì±…",
                question: "í˜¸ì¡±ì„ í†µì œí•˜ê³  ì™•ê¶Œì„ ê°•í™”í•˜ê¸° ìœ„í•´ íƒœì¡°ê°€ ë‚¨ê¸´ ìœ í›ˆì€?",
                choices: ["ê²½êµ­ëŒ€ì „", "í›ˆìš” 10ì¡°", "ì‹œë¬´ 28ì¡°", "ëŒ€ë™ë²•", "ì‚¼êµ­ì‚¬ê¸°"],
                answer: 1
            },
            {
                floor: 21,
                era: "ë¬¸ë²Œ ê·€ì¡± ì‚¬íšŒ",
                question: "ë¬¸ë²Œ ê·€ì¡± ì‚¬íšŒê°€ í”ë“¤ë¦¬ë©° ë°œìƒí•œ ì‚¬ê±´ì€?",
                choices: ["ë…¸ë¹„ì•ˆê²€ë²• ì‹¤ì‹œ", "ê³¼ê±°ì œ ë„ì…", "í›ˆìš” 10ì¡° ë°˜í¬", "ë¬˜ì²­ì˜ ì„œê²½ ì²œë„ ìš´ë™", "ëŒ€ë™ë²• ì‹œí–‰"],
                answer: 3
            },
            {
                floor: 20,
                era: "ë¬´ì‹  ì •ë³€",
                question: "1170ë…„ì— ì¼ì–´ë‚œ ì •ì¹˜ì  ì‚¬ê±´ì€?",
                choices: ["ìœ„í™”ë„ íšŒêµ°", "ë¬´ì‹  ì •ë³€", "ëª½ê³¨ ì¹¨ì…", "ê±°ë€ ì¹¨ì…", "ê³µë¯¼ì™• ê°œí˜"],
                answer: 1
            },
            {
                floor: 19,
                era: "ë¬´ì‹  ì •ê¶Œ",
                question: "ë¬´ì‹  ì •ê¶Œ ì‹œê¸° ìµœê³  ê¶Œë ¥ìê°€ ì•„ë‹Œ ì¸ë¬¼ì€?",
                choices: ["ìµœìš°", "ì •ì¤‘ë¶€", "ìµœí•­", "ì´ìê²¸", "ìµœì¶©í—Œ"],
                answer: 3
            },
            {
                floor: 18,
                era: "ëª½ê³¨ ì¹¨ì…",
                question: "ëª½ê³¨ ì¹¨ì…ì— ë§ì„œ ê³ ë ¤ê°€ ìˆ˜ë„ë¥¼ ì˜®ê¸´ ê³³ì€?",
                choices: ["ê°•í™”ë„", "ê°œê²½", "í•´ì£¼", "ì„œê²½", "í‰ì–‘"],
                answer: 0
            },
            {
                floor: 17,
                era: "ëŒ€ëª½ í•­ìŸ",
                question: "ëŒ€ëª½ í•­ìŸ ê³¼ì •ì—ì„œ ì¡°ì„±ëœ ë¶ˆêµ ë¬¸í™”ìœ ì‚°ì€?",
                choices: ["ì„êµ´ì•”", "ì§ì§€", "íŒ”ë§ŒëŒ€ì¥ê²½", "ê¸ˆë™ ë¯¸ë¥µë³´ì‚´ ë°˜ê°€ìƒ", "ë¶ˆêµ­ì‚¬"],
                answer: 2
            },
            {
                floor: 16,
                era: "ì› ê°„ì„­ê¸°",
                question: "ì› ê°„ì„­ê¸°ì— ì›ê³¼ì˜ ê´€ê³„ë¥¼ í†µí•´ ë“±ì¥í•œ ì§€ë°° ì„¸ë ¥ì€?",
                choices: ["ì‹ ì§„ ì‚¬ëŒ€ë¶€", "ì‚¬ë¦¼", "í–¥ë¦¬", "í›ˆêµ¬", "ê¶Œë¬¸ì„¸ì¡±"],
                answer: 4
            },
            {
                floor: 15,
                era: "ê³µë¯¼ì™•ì˜ ê°œí˜",
                question: "ê³µë¯¼ì™•ì˜ ê°œí˜ ì •ì±…ìœ¼ë¡œ ì˜³ì€ ê²ƒì€?",
                choices: ["ìŒì„±ì´ê´€ë¶€ ìˆ˜ë³µ", "ìœ„í™”ë„ íšŒêµ°", "ê³¼ì „ë²• ì‹¤ì‹œ", "í•œì–‘ ì²œë„", "ê²½êµ­ëŒ€ì „ ë°˜í¬"],
                answer: 0
            },
            {
                floor: 14,
                era: "ê³ ë ¤ ë§ ê°œí˜",
                question: "ê³ ë ¤ ë§ ìƒˆë¡œìš´ ê°œí˜ ì„¸ë ¥ì€?",
                choices: ["ê¶Œë¬¸ì„¸ì¡±", "ì‹ ì§„ ì‚¬ëŒ€ë¶€", "ìŠ¹ë ¤", "í˜¸ì¡±", "ë¬¸ë²Œ ê·€ì¡±"],
                answer: 1
            },
            {
                floor: 13,
                era: "ì¡°ì„  ê±´êµ­",
                question: "ì¡°ì„ ì„ ê±´êµ­í•˜ì—¬ ì²« ì™•ì— ì˜¤ë¥¸ ì¸ë¬¼ì€?",
                choices: ["ì´ë°©ì›", "ì •ë„ì „", "ìµœì˜", "ì •ëª½ì£¼", "ì´ì„±ê³„"],
                answer: 4
            },
            {
                floor: 12,
                era: "ì¡°ì„  í† ì§€ ì œë„",
                question: "ì¡°ì„  ê±´êµ­ ì§í›„ ì‹¤ì‹œëœ í† ì§€ ì œë„ëŠ”?",
                choices: ["ëŒ€ë™ë²•", "í•œì „ì œ", "ê³¼ì „ë²•", "ì˜ì •ë²•", "ê· ì „ì œ"],
                answer: 2
            },
            {
                floor: 11,
                era: "ì¡°ì„ ì˜ í†µì¹˜ ì´ë…",
                question: "ì¡°ì„ ì˜ ì£¼ëœ í†µì¹˜ ì´ë…ì€?",
                choices: ["ë²•ê°€", "ë¶ˆêµ", "ë„êµ", "ì„±ë¦¬í•™(ìœ í•™)", "ì‹¤í•™"],
                answer: 3
            },
            {
                floor: 10,
                era: "ì¡°ì„  ë²•ì „",
                question: "ã€ê²½êµ­ëŒ€ì „ã€ì´ ì™„ì„±ëœ ì‹œê¸°ì˜ ì™•ì€?",
                choices: ["ì„¸ì¢…", "íƒœì¢…", "ì¤‘ì¢…", "ì„±ì¢…", "ì„¸ì¡°"],
                answer: 3
            },
            {
                floor: 9,
                era: "ì„¸ì¢… ëŒ€ì™•",
                question: "ì„¸ì¢… ëŒ€ì— ì°½ì œëœ ë¬¸ìëŠ”?",
                choices: ["í›ˆë¯¼ì •ìŒ", "í•œì", "ì´ë‘", "êµ¬ê²°", "í–¥ì°°"],
                answer: 0
            },
            {
                floor: 8,
                era: "ì‚¬ë¦¼ì˜ ë“±ì¥",
                question: "ì‚¬ë¦¼ì´ ì¤‘ì•™ ì •ì¹˜ì— ì§„ì¶œí•œ ì‹œê¸°ëŠ”?",
                choices: ["ì„¸ì¢…", "ì„±ì¢…", "ì„ ì¡°", "íƒœì¡°", "íƒœì¢…"],
                answer: 1
            },
            {
                floor: 7,
                era: "ì„ì§„ì™œë€",
                question: "ì„ì§„ì™œë€ì´ ì‹œì‘ëœ í•´ëŠ”?",
                choices: ["1597ë…„", "1603ë…„", "1592ë…„", "1590ë…„", "1627ë…„"],
                answer: 2
            },
            {
                floor: 6,
                era: "ì–‘ ë‚œ ì´í›„",
                question: "ì–‘ ë‚œ ì´í›„ ìœ„ìƒì´ ê°•í™”ëœ ì •ì¹˜ ê¸°êµ¬ëŠ”?",
                choices: ["ìŠ¹ì •ì›", "ì˜ì •ë¶€", "í™ë¬¸ê´€", "ì‚¼ì‚¬", "ë¹„ë³€ì‚¬"],
                answer: 4
            },
            {
                floor: 5,
                era: "ê³µë‚© ê°œí˜",
                question: "ê³µë‚©ì˜ íë‹¨ì„ í•´ê²°í•˜ê¸° ìœ„í•´ ì‹œí–‰ëœ ì œë„ëŠ”?",
                choices: ["ê· ì—­ë²•", "ì˜ì •ë²•", "í˜¸í¬ë²•", "ì§ì „ë²•", "ëŒ€ë™ë²•"],
                answer: 4
            },
            {
                floor: 4,
                era: "íƒ•í‰ ì •ì¹˜",
                question: "ì˜ì¡°ì™€ ì •ì¡°ê°€ ì¶”ì§„í•œ ì •ì¹˜ ì›ë¦¬ëŠ”?",
                choices: ["í™˜êµ­ ì •ì¹˜", "êµ°ì£¼ ì „ì œ", "íƒ•í‰ ì •ì¹˜", "ì„¸ë„ ì •ì¹˜", "ë¶•ë‹¹ ì •ì¹˜"],
                answer: 2
            },
            {
                floor: 3,
                era: "ì„¸ë„ ì •ì¹˜ê¸°",
                question: "ì„¸ë„ ì •ì¹˜ ì‹œê¸° ë†ë¯¼ ë´‰ê¸°ë¡œ ì˜³ì€ ê²ƒì€?",
                choices: ["ì„ì˜¤êµ°ë€", "ê°‘ì‹ ì •ë³€", "ë™í•™ ë†ë¯¼ ìš´ë™", "í™ê²½ë˜ì˜ ë‚œ", "3Â·1 ìš´ë™"],
                answer: 3
            },
            {
                floor: 2,
                era: "ì‹¤í•™ì˜ ë°œë‹¬",
                question: "ì¡°ì„  í›„ê¸° ìƒˆë¡œìš´ í•™ë¬¸ ê²½í–¥ìœ¼ë¡œ ê°€ì¥ ì ì ˆí•œ ê²ƒì€?",
                choices: ["ì‹¤í•™", "ë¶ˆêµ", "ë„êµ", "ë²•ê°€", "ì„±ë¦¬í•™"],
                answer: 0
            },
            {
                floor: 1,
                era: "ì¡°ì„  í›„ê¸° ì‚¬íšŒ",
                question: "ë‹¤ìŒ ì¤‘ 'ì¡°ì„  í›„ê¸° ì‚¬íšŒ ë³€ë™'ì— ëŒ€í•œ ì„¤ëª…ìœ¼ë¡œ ê°€ì¥ ì ì ˆí•œ ê²ƒì€?",
                choices: [
                    "ì‹ ë¶„ì œê°€ ì™„ì „íˆ íì§€ë˜ì—ˆë‹¤.",
                    "ì¡°ì„¸Â·ì‹ ë¶„Â·ì˜ì‹ êµ¬ì¡°ê°€ ë™ì‹œì— í”ë“¤ë¦¬ê¸° ì‹œì‘í–ˆë‹¤.",
                    "ë†ë¯¼ ë´‰ê¸°ëŠ” ì™¸ì„¸ ë°°ê²©ë§Œì„ ëª©í‘œë¡œ í•˜ì˜€ë‹¤.",
                    "ì‹¤í•™ì€ ê¸°ì¡´ ì„±ë¦¬í•™ì„ ì „ë©´ ë¶€ì •í•˜ì˜€ë‹¤.",
                    "ë¶•ë‹¹ ì •ì¹˜ê°€ ì œë„ì ìœ¼ë¡œ ì‚¬ë¼ì¡Œë‹¤."
                ],
                answer: 1
            }
        ];

        // ========== ì…”í”Œëœ ë¬¸ì œ ë°ì´í„° ==========
        let questions = [];

        // ========== ê²Œì„ ìƒíƒœ ë³€ìˆ˜ ==========
        let currentFloor = 0;
        let mistakes = 0;
        let safeZone = -1;
        let playerName = '';
        let startTime = null;
        let timerInterval = null;
        let isProcessing = false; // ì¤‘ë³µ í´ë¦­ ë°©ì§€

        // ========== ì„ íƒì§€ ì…”í”Œ í•¨ìˆ˜ ==========
        function shuffleChoices(questionData) {
            const choices = [...questionData.choices];
            const correctAnswer = choices[questionData.answer];
            
            // Fisher-Yates ì…”í”Œ
            for (let i = choices.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [choices[i], choices[j]] = [choices[j], choices[i]];
            }
            
            // ìƒˆë¡œìš´ ì •ë‹µ ì¸ë±ìŠ¤ ì°¾ê¸°
            const newAnswerIndex = choices.indexOf(correctAnswer);
            
            return {
                ...questionData,
                choices: choices,
                answer: newAnswerIndex
            };
        }

        // ========== ëª¨ë“  ë¬¸ì œ ì…”í”Œ ==========
        function shuffleAllQuestions() {
            questions = originalQuestions.map(q => shuffleChoices(q));
        }

        // ========== íŠ¹ì • ë²”ìœ„ ë¬¸ì œë§Œ ì…”í”Œ ==========
        function shuffleQuestionsFromFloor(startIndex) {
            for (let i = startIndex; i < questions.length; i++) {
                questions[i] = shuffleChoices(originalQuestions[i]);
            }
        }

        // ========== URL ì„¤ì • í™•ì¸ ==========
        function isConfigured() {
            return GOOGLE_SCRIPT_URL && GOOGLE_SCRIPT_URL !== 'YOUR_GOOGLE_SCRIPT_URL_HERE';
        }

        // ========== ì´ë¦„ ì…ë ¥ ê²€ì¦ ==========
        document.getElementById('playerName').addEventListener('input', function() {
            const name = this.value.trim();
            document.getElementById('startBtn').disabled = name.length < 2;
        });

        // ========== ê²Œì„ ì‹œì‘ ==========
        function startGame() {
            playerName = document.getElementById('playerName').value.trim();
            if (playerName.length < 2) {
                alert('ì´ë¦„ì„ 2ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            // ê²Œì„ ì‹œì‘ ì‹œ ëª¨ë“  ë¬¸ì œ ì…”í”Œ
            shuffleAllQuestions();

            document.getElementById('introScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            
            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);
            
            loadQuestion();
        }

        // ========== íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸ ==========
        function updateTimer() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
            const seconds = (elapsed % 60).toString().padStart(2, '0');
            document.getElementById('timerDisplay').textContent = `${minutes}:${seconds}`;
        }

        // ========== ë¬¸ì œ ë¡œë“œ ==========
        function loadQuestion() {
            const q = questions[currentFloor];
            const floorNum = q.floor;
            
            document.getElementById('floorDisplay').textContent = `B${floorNum}F`;
            document.getElementById('eraDisplay').textContent = q.era;
            document.getElementById('question').textContent = q.question;
            
            const choicesDiv = document.getElementById('choices');
            choicesDiv.innerHTML = '';
            
            // ì•½ê°„ì˜ ë”œë ˆì´ í›„ ë²„íŠ¼ ìƒì„± (ëª¨ë°”ì¼ í„°ì¹˜ ë¬¸ì œ ë°©ì§€)
            setTimeout(() => {
                q.choices.forEach((choice, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'choice-btn';
                    btn.textContent = `${index + 1}. ${choice}`;
                    
                    // í„°ì¹˜ì™€ í´ë¦­ ëª¨ë‘ ì²˜ë¦¬
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        if (!isProcessing) {
                            checkAnswer(index);
                        }
                    });
                    
                    choicesDiv.appendChild(btn);
                });
            }, 100);

            const progress = ((25 - currentFloor) / 25) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('mistakeCount').textContent = mistakes;
            document.getElementById('safeZoneStatus').textContent = safeZone !== -1 ? 'âœ…' : 'âŒ';
        }

        // ========== ì •ë‹µ í™•ì¸ ==========
        function checkAnswer(selected) {
            if (isProcessing) return;
            isProcessing = true;

            const q = questions[currentFloor];
            
            if (selected === q.answer) {
                // ì •ë‹µ!
                document.getElementById('gameContainer').classList.add('success-glow');
                
                // B10 í†µê³¼ ì‹œ ì•ˆì „ì§€ëŒ€ í™œì„±í™”
                if (currentFloor === 15) { // ë°°ì—´ ì¸ë±ìŠ¤ 15 = B10F
                    safeZone = 16; // ì•ˆì „ì§€ëŒ€ = B9F (ì¸ë±ìŠ¤ 16)
                    showModal(
                        "ğŸ›¡ï¸ ì•ˆì „ì§€ëŒ€ í™œì„±í™”!",
                        `B10F í†µê³¼!<br><br>ì´ì œë¶€í„° ì˜¤ë‹µì´ ë‚˜ì™€ë„<br>B10F(ì•ˆì „ì§€ëŒ€)ë¡œ ë³µê·€í•©ë‹ˆë‹¤.`,
                        () => {
                            isProcessing = false;
                            currentFloor++;
                            if (currentFloor < questions.length) {
                                loadQuestion();
                            } else {
                                showVictory();
                            }
                        }
                    );
                } else {
                    currentFloor++;
                    if (currentFloor < questions.length) {
                        showModal(
                            "âœ… ì •ë‹µì…ë‹ˆë‹¤!",
                            `ë¬¸ì´ ì—´ë ¸ìŠµë‹ˆë‹¤.<br>B${questions[currentFloor].floor}Fë¡œ ì˜¬ë¼ê°‘ë‹ˆë‹¤...`,
                            () => {
                                isProcessing = false;
                                loadQuestion();
                            }
                        );
                    } else {
                        isProcessing = false;
                        showVictory();
                    }
                }
                
                setTimeout(() => {
                    document.getElementById('gameContainer').classList.remove('success-glow');
                }, 1000);
                
            } else {
                // ì˜¤ë‹µ!
                mistakes++;
                document.getElementById('gameContainer').classList.add('shock-effect');
                
                setTimeout(() => {
                    document.getElementById('gameContainer').classList.remove('shock-effect');
                }, 500);
                
                if (mistakes >= 5) {
                    isProcessing = false;
                    showGameOver();
                } else {
                    // ë³µê·€í•  ì¸µ ê²°ì •
                    let resetFloor;
                    let resetMessage;
                    
                    if (safeZone !== -1) {
                        // ì•ˆì „ì§€ëŒ€ í™œì„±í™” ìƒíƒœ: B10F(ì¸ë±ìŠ¤ 16)ë¡œ ë³µê·€
                        resetFloor = safeZone;
                        resetMessage = 'B10F ì•ˆì „ì§€ëŒ€';
                    } else {
                        // ì•ˆì „ì§€ëŒ€ ì—†ìŒ: B25F(ì¸ë±ìŠ¤ 0)ë¡œ ë³µê·€
                        resetFloor = 0;
                        resetMessage = 'B25F';
                    }
                    
                    showModal(
                        "âš¡ ì „ê¸° ì¶©ê²©!",
                        `ì†ì¡ì´ë¥¼ ì¡ê³  ë¬¸ì„ ì—´ë ¤ê³  í•˜ëŠ” ìˆœê°„...<br>ì§€ì§€ì§€ì§!! ì˜ì‹ì„ ìƒê³  ë§ì•˜ìŠµë‹ˆë‹¤.<br><br>ì—­ì‚¬ì˜ ê· ì—´ì´ ì‹¬í•´ì§€ê³  ìˆìŠµë‹ˆë‹¤...<br>(${mistakes}/5)<br><br>${resetMessage}ë¡œ ë³µê·€í•©ë‹ˆë‹¤.`,
                        () => {
                            isProcessing = false;
                            currentFloor = resetFloor;
                            // ë³µê·€ ì‹œ í•´ë‹¹ ì¸µë¶€í„° ì„ íƒì§€ ë‹¤ì‹œ ì…”í”Œ
                            shuffleQuestionsFromFloor(resetFloor);
                            loadQuestion();
                        }
                    );
                }
            }
        }

        // ========== ëª¨ë‹¬ í‘œì‹œ ==========
        function showModal(title, message, callback) {
            const modal = document.getElementById('modal');
            const content = document.getElementById('modalContent');
            
            content.innerHTML = `
                <h2>${title}</h2>
                <p>${message}</p>
                <button class="modal-btn" id="modalBtn">í™•ì¸</button>
            `;
            
            modal.style.display = 'flex';
            
            // ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            const modalBtn = document.getElementById('modalBtn');
            modalBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                modal.style.display = 'none';
                if (callback) {
                    // ë”œë ˆì´ë¥¼ ì£¼ì–´ ë‹¤ìŒ í™”ë©´ì˜ ë²„íŠ¼ì´ ëˆŒë¦¬ëŠ” ê²ƒ ë°©ì§€
                    setTimeout(callback, 150);
                }
            });
        }

        // ========== ê²Œì„ ì˜¤ë²„ ==========
        function showGameOver() {
            clearInterval(timerInterval);
            
            const modal = document.getElementById('modal');
            const content = document.getElementById('modalContent');
            
            content.innerHTML = `
                <h2 style="background: linear-gradient(135deg, #ff0080, #ff6b6b); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">ğŸ’¥ ê· ì—´ ë¶•ê´´!</h2>
                <p>ì—­ì‚¬ì˜ ê· ì—´ì´ ì™„ì „íˆ ì»¤ì ¸<br>ê±·ì¡ì„ ìˆ˜ ì—†ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.<br><br>ê³ ë ¤ì™€ ì¡°ì„ ì˜ ì—­ì‚¬ê°€ ì‚¬ë¼ì¡ŒìŠµë‹ˆë‹¤....</p>
                <p>ì˜¤ë‹µ íšŸìˆ˜: ${mistakes}íšŒ</p>
                <button class="modal-btn" id="resetBtn">ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘</button>
            `;
            
            modal.style.display = 'flex';
            
            document.getElementById('resetBtn').addEventListener('click', function(e) {
                e.preventDefault();
                resetGame();
            });
        }

        // ========== ìŠ¹ë¦¬ + ë¦¬ë”ë³´ë“œ ì €ì¥ ==========
        async function showVictory() {
            clearInterval(timerInterval);
            
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            const timeString = `${minutes}ë¶„ ${seconds}ì´ˆ`;

            // ë¦¬ë”ë³´ë“œì— ê¸°ë¡ ì €ì¥
            await saveToLeaderboard(playerName, elapsed, mistakes);

            const modal = document.getElementById('modal');
            const content = document.getElementById('modalContent');
            
            content.innerHTML = `
                <h2>ğŸ‰ íƒˆì¶œ ì„±ê³µ!</h2>
                <p>ì¶•í•˜í•©ë‹ˆë‹¤, <strong style="color: #00ffc8;">${playerName}</strong>ë‹˜!</p>
                <p>ì—­ì‚¬ì˜ ê· ì—´ì„ ë‹«ê³ <br>ì§€í•˜ì—ì„œ íƒˆì¶œí–ˆìŠµë‹ˆë‹¤!</p>
                <p style="margin-top: 15px;">
                    â±ï¸ í´ë¦¬ì–´ ì‹œê°„: <strong style="color: #00ffc8;">${timeString}</strong><br>
                    âŒ ì´ ì˜¤ë‹µ íšŸìˆ˜: <strong style="color: #ff0080;">${mistakes}íšŒ</strong>
                </p>
                <p style="font-size: 0.9em; color: #a0a0b0; margin-top: 15px;">ê¸°ë¡ì´ ëª…ì˜ˆì˜ ì „ë‹¹ì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!</p>
                <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                    <button class="modal-btn" id="retryBtn">ë‹¤ì‹œ ë„ì „</button>
                    <button class="modal-btn" id="leaderboardBtn" style="background: linear-gradient(135deg, #ff0080, #7b2fff);">ëª…ì˜ˆì˜ ì „ë‹¹</button>
                </div>
            `;
            
            modal.style.display = 'flex';
            
            document.getElementById('retryBtn').addEventListener('click', function(e) {
                e.preventDefault();
                resetGame();
            });
            
            document.getElementById('leaderboardBtn').addEventListener('click', function(e) {
                e.preventDefault();
                modal.style.display = 'none';
                showLeaderboard();
            });
        }

        // ========== Google Sheetsì— ê¸°ë¡ ì €ì¥ ==========
        async function saveToLeaderboard(name, timeSeconds, mistakes) {
            if (!isConfigured()) {
                console.warn('Google Script URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }

            try {
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name: name,
                        time: timeSeconds,
                        mistakes: mistakes
                    })
                });
                console.log('ê¸°ë¡ ì €ì¥ ì™„ë£Œ');
            } catch (error) {
                console.error('ê¸°ë¡ ì €ì¥ ì‹¤íŒ¨:', error);
            }
        }

        // ========== ë¦¬ë”ë³´ë“œ ë¶ˆëŸ¬ì˜¤ê¸° ==========
        async function loadLeaderboard() {
            if (!isConfigured()) {
                return null;
            }

            try {
                const response = await fetch(GOOGLE_SCRIPT_URL);
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('ë¦¬ë”ë³´ë“œ ë¡œë“œ ì‹¤íŒ¨:', error);
                return null;
            }
        }

        // ========== ë¦¬ë”ë³´ë“œ í‘œì‹œ ==========
        async function showLeaderboard() {
            document.getElementById('introScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('leaderboardScreen').style.display = 'block';

            const contentDiv = document.getElementById('leaderboardContent');
            
            if (!isConfigured()) {
                contentDiv.innerHTML = `
                    <div class="setup-notice">
                        âš ï¸ Google Sheets ì—°ë™ì´ í•„ìš”í•©ë‹ˆë‹¤.<br><br>
                        HTML íŒŒì¼ì˜ <code>GOOGLE_SCRIPT_URL</code> ê°’ì„<br>
                        Google Apps Script ì›¹ ì•± URLë¡œ êµì²´í•´ì£¼ì„¸ìš”.
                    </div>
                `;
                return;
            }

            contentDiv.innerHTML = '<div class="no-records"><span class="loading-spinner"></span> ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';

            try {
                const leaderboard = await loadLeaderboard();

                if (!leaderboard || leaderboard.length === 0) {
                    contentDiv.innerHTML = '<div class="no-records">ì•„ì§ íƒˆì¶œ ì„±ê³µ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.<br>ì²« ë²ˆì§¸ ì˜ì›…ì´ ë˜ì–´ë³´ì„¸ìš”! ğŸ¦¸</div>';
                    return;
                }

                let tableHTML = `
                    <table class="leaderboard-table">
                        <thead>
                            <tr>
                                <th>ìˆœìœ„</th>
                                <th>ì´ë¦„</th>
                                <th>ì‹œê°„</th>
                                <th>ì˜¤ë‹µ</th>
                                <th>ë‚ ì§œ</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                leaderboard.slice(0, 20).forEach((record, index) => {
                    const rank = index + 1;
                    const minutes = Math.floor(record.time / 60);
                    const seconds = record.time % 60;
                    const timeStr = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                    
                    // ë‚ ì§œ í¬ë§·
                    let dateStr = record.date || '-';
                    if (dateStr.includes('/') || dateStr.includes('-')) {
                        try {
                            const d = new Date(dateStr);
                            dateStr = `${d.getMonth()+1}/${d.getDate()}`;
                        } catch (e) {
                            // ì›ë³¸ ìœ ì§€
                        }
                    }

                    let rankBadge = rank;
                    if (rank === 1) rankBadge = '<span class="rank-badge gold">1</span>';
                    else if (rank === 2) rankBadge = '<span class="rank-badge silver">2</span>';
                    else if (rank === 3) rankBadge = '<span class="rank-badge bronze">3</span>';

                    tableHTML += `
                        <tr>
                            <td>${rankBadge}</td>
                            <td>${escapeHTML(record.name)}</td>
                            <td>${timeStr}</td>
                            <td>${record.mistakes}íšŒ</td>
                            <td>${dateStr}</td>
                        </tr>
                    `;
                });

                tableHTML += '</tbody></table>';
                contentDiv.innerHTML = tableHTML;

            } catch (error) {
                console.error('ë¦¬ë”ë³´ë“œ ë¡œë“œ ì‹¤íŒ¨:', error);
                contentDiv.innerHTML = '<div class="no-records">ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>';
            }
        }

        // ========== ë¦¬ë”ë³´ë“œ ìˆ¨ê¸°ê¸° ==========
        function hideLeaderboard() {
            document.getElementById('leaderboardScreen').style.display = 'none';
            document.getElementById('introScreen').style.display = 'block';
        }

        // ========== HTML ì´ìŠ¤ì¼€ì´í”„ ==========
        function escapeHTML(str) {
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        // ========== ê²Œì„ ë¦¬ì…‹ ==========
        function resetGame() {
            currentFloor = 0;
            mistakes = 0;
            safeZone = -1;
            startTime = null;
            isProcessing = false;
            clearInterval(timerInterval);
            
            document.getElementById('modal').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('leaderboardScreen').style.display = 'none';
            document.getElementById('introScreen').style.display = 'block';
            document.getElementById('playerName').value = playerName;
            document.getElementById('startBtn').disabled = playerName.length < 2;
        }

        // ========== ì´ˆê¸° ì„¤ì • ==========
        document.getElementById('startBtn').disabled = true;
    </script>
</body>
</html>
